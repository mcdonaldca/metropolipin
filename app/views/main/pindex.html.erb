
<div class="options">
	<div class="backwards">
		<%= link_to "<< map", explore_url(city: session[:search]), method: :post %>
	</div>
</div>

<div class="pin-details">
	<% @city.pins.each do |pin| %>
		<div class="pin" id="pin<%= pin.id %>" data-id="<%= pin.id %>">
			<div class="row row1">
				<div class="circle pushpin">
				</div>
				<h2><%= pin.title %></h2>
			</div>
			<div class="row row2">
				<% if pin.ratings.count == 1 %>
					<% pin.ratings.each do |rating| %>
						<div class="circle friend" id="friend<%= pin.id %>" style="background-image:url(<%= rating.user.profile_picture %>);background-size:2em 2em;">
						</div>
						<h3><%= rating.user.first %> <%= rating.user.last[0].upcase %></h3>
					<% end %>
				<% else %>
					<div class="circle friends">
						<%= pin.ratings.count %>
					</div>
					<h3 style="top:.05em;"><%= pin.ratings.count %> friends have been here</h3>
				<% end %>
			</div>
		</div>
		<% if pin.ratings.count != 1 %>
			<div class="row3" id="people<%= pin.id %>">
			<% pin.ratings.each do |rating| %>
				<div class="item">
					<div class="circle friend" id="friend<%= pin.id %>" style="background-image:url(<%= rating.user.profile_picture %>);background-size:2em 2em;">
					</div>
					<h3><%= rating.user.first %> <%= rating.user.last[0].upcase %></h3>
				</div>
			<% end %>
			</div>
		<% end %>
	<% end %>
</div>

<script>
$(".pin .row1").click(function() {
	var id = $(this).parent().attr("id");
	$("#" + id).toggleClass("selected");
	$(this).children().toggleClass("selected");
	$(this).next().children().toggleClass("selected");
});

$(".pin .row2").click(function() {
	var id = $(this).parent().attr("data-id");
	var next = $(this).parent().next();
	if (next.hasClass("row3")) {
		next.toggle();
	}
});
</script>